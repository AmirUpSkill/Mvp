# eval-service/app/schemas/evaluation.py

from pydantic import BaseModel, Field
from typing import Optional, Dict, Any # Use Dict and Any for flexible generated_json

# Note: We do NOT import GeneratedTicketData here because the *input*
# might not conform perfectly to it, and we want the LLM evaluator
# to handle that assessment. We only expect a dictionary-like object.

class EvaluateTicketRequest(BaseModel):
    """
    Schema defining the request body for the ticket evaluation endpoint.
    It requires the JSON generated by the AI service and the prompt used to create it.
    """
    generated_json: Dict[str, Any] = Field(
        ..., # Ellipsis indicates this field is required
        example={"title": "Example Title", "description": "Example desc.", "priority": "Medium"},
        description="The JSON object generated by the upstream AI service that needs evaluation."
    )
    original_system_prompt: str = Field(
        ...,
        example="Extract title, description, and priority (High/Medium/Low) into a JSON object...",
        description="The exact system prompt given to the AI service to generate the 'generated_json'."
    )

class EvaluateTicketResponse(BaseModel):
    """
    Schema defining the successful response structure after evaluation by the LLM.
    """
    is_valid: bool = Field(
        ...,
        description="The boolean verdict from the evaluation LLM. True if criteria met, False otherwise."
    )
    evaluation_reasoning: Optional[str] = Field(
        None, # Default to None, making it optional
        example="The generated JSON adheres to the required schema and captures the core requirements from the prompt.",
        description="Optional textual explanation from the evaluation LLM justifying the verdict."
    )

    # Optional: Add example configuration for FastAPI docs if needed
    # class Config:
    #     json_schema_extra = {
    #         "examples": [
    #             {
    #                 "is_valid": True,
    #                 "evaluation_reasoning": "Matches schema and prompt intent."
    #             },
    #              {
    #                 "is_valid": False,
    #                 "evaluation_reasoning": "Missing required 'priority' field."
    #             }
    #         ]
    #     }